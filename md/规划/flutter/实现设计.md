# 视频合并工具 - Flutter 实现设计

## 技术栈

| 库 | 版本 | 用途 |
|---|------|------|
| flutter_riverpod | ^3.1.0 | 状态管理 |
| riverpod_annotation | ^4.0.0 | @riverpod 注解 |
| riverpod_generator | ^4.0.0 | 代码生成 |
| freezed | ^3.0.6 | 不可变状态类生成 |
| go_router | - | 路由导航 |
| shared_preferences | - | 用户偏好存储 |
| file_picker | - | 选择视频文件 |
| desktop_drop | - | 桌面端拖放文件 |

## 项目管理

使用 Flutter workspace + Melos 管理，遵循参考项目的命令规范。

---

## 目录结构

```
video_concat/
├── pubspec.yaml
├── melos.yaml
├── packages/
│   └── ffmpeg_kit/              # FFmpeg 模块
└── apps/
    └── video_concat_app/        # 主应用
```

### ffmpeg_kit 模块

```
ffmpeg_kit/lib/
├── src/
│   ├── ffmpeg_service.dart
│   └── video_concat_service.dart
└── ffmpeg_kit.dart
```

### video_concat_app 应用

```
video_concat_app/lib/
├── main.dart
└── src/
    ├── app.dart
    ├── router/
    │   └── app_router.dart
    ├── models/
    ├── repositories/
    ├── view_models/
    └── views/
        ├── home/
        └── settings/
```

---

## 状态管理模式

- 使用 `@riverpod` 注解定义 ViewModel
- 使用 `@freezed` 定义不可变状态类
- Service/Repository 使用 `@Riverpod(keepAlive: true)`

---

## 路由模式

使用 `go_router`，通过 `@Riverpod(keepAlive: true)` 提供 `GoRouter` 实例。

---

## 拖动排序

使用 `ReorderableListView.builder`，设置 `buildDefaultDragHandles: false`，使用 `ReorderableDragStartListener` 实现拖动手柄。

---

## 文件拖放

使用 `desktop_drop` 包的 `DropTarget` 组件包裹内容区域。

---

## FFmpeg 进程管理

- 使用 `dart:io` 的 `Process.start` 启动进程
- 监听 stdout/stderr 获取实时输出
- 使用 `Process.kill()` 中断执行

---

## 视频合并命令

使用 FFmpeg concat demuxer 方式：

```bash
ffmpeg -f concat -safe 0 -i filelist.txt -c copy output.mp4
```
